{"posts":[{"title":"优化Linux中rm的删除逻辑","content":"在腾讯开发者中心刷帖的时候发现了这么一个帖子“使用shell脚本来优化rm的删除逻辑”，配图如下 我想起每次无意中使用rm -rf来删除当时以为不重要的文件，之后又要重新下载的蛋疼时刻，虽然有人推荐用alias rm=mv来代替rm，但是使用体验并非那么美好，看到这个帖子后，很感兴趣就打算用shell来写一个。 但是，几年没有使用过shell了，语法也忘光了，写起来磕磕碰碰，正好我现在在学python，正好使用python来实现 脚本如下： import os import sys list_file = sys.argv[1:] def rm_optimeize(): for file_source in list_file: file_ta = os.path.exists(file_source) file_size = os.path.getsize(file_source) if file_ta and file_size &gt; 102400: ask = input(&quot;文件大于1G，是否删除[yes/no]&quot;) if ask == &quot;yes&quot;: os.system(f'rm -rf {file_source}') else: os.system(f'mv {file_source} /tmp') elif file_ta and file_size &lt; 102400: os.system(f'mv {file_source} /tmp') elif not file_ta: continue if sys.argv[1] == &quot;./*&quot;: rm_optimeize() else: rm_optimeize() 脚本的整体逻辑很简单，就是图上的逻辑 首先获取外部传入的参数，如文件名 获取到参数后存到变量中，变量是一个列表，所以可以存放多个参数 使用fro循环来遍历参数，进行判断，比如文件是否存在，文件大小判断，然后进行处理 为了兼容rm -rf ./*语法，启动脚本后会先进行一个字符串的判断 上面的脚本可以直接拿来用，本次练习到此结束 ","link":"https://qianmianyao.cn/post/python_rm/"},{"title":"Debian更新内核","content":"体验新内核新特性 Debian 使用uname -a查看内核，输出如下 Linux VM-8-12-debian 4.19.0-11-amd64 #1 SMP Debian 4.19.146-1 (2020-09-17) x86_64 GNU/Linux 编译安装内核 首先去官网或者国内镜像站下载需要的内核版本 解压且进入解压包 使用make menuconfig来进行配置 按照提示安装所需要的依赖即可 修改生成的.config文件，编辑CONFIG_SYSTEM_TRUSTED_KEYS=&quot;&quot;使其为空 禁用签名 scripts/config --disable MODULE_SIG scripts/config --disable DEBUG_INFO 使用make deb-pkg生成deb包 使用- j选项可以调用更多核心，比如make -j 8 deb-pkg 编译完毕后会在所在文件夹的根目录出现3个编译完成的deb文件，直接安装重启即可 卸载旧内核 使用dpkg --list | grep linux-image 来查看安装的所有内核 debina中内核的包名是linux-images，redhat中包名kernel 卸载内核需要删除内核文件和头部文件 $ apt purge linux-image-version $ apt purge linux-headers-version ","link":"https://qianmianyao.cn/post/debian-geng-xin-nei-he/"},{"title":"利用WARP进行流媒体解锁","content":"逛Github的时候看推荐发现了这个项目，结果就是一晚上没睡，并且付出了63元的测试结果下，决定水一篇文章 Warp是CloudFlare推出的一个VPN服务，目的在于加密流量和IP，实现匿名访问，具体信息可以参考官方的博文👉Introducing WARP: Fixing Mobile Internet Performance and Security 手动配置其实也不难，为了更方便这里当然推荐使用一键脚本 missuo/CloudflareWarp 开始 首先确保你的VPS内核版本≥5.X，如果不符合要请先更新内核，这里使用Debian10作为演示 1.添加源，打开 /etc/apt/source.list 在尾部添加如下内容 deb https://deb.debian.org/debian buster-backports main 2.安装内核后重新启动 apt install -t buster-backports linux-image-cloud-amd64 linux-headers-cloud-amd64 &amp;&amp; reboot 3.内核安装完毕后执行一键脚本 wget -O warp.sh https://raw.githubusercontent.com/missuo/CloudflareWarp/main/warp.sh &amp;&amp; bash warp.sh 4.脚本执行完毕后会出现如下选项，选择4，增加IPV6，等待执行完毕即可 5.ipv6测试，输入 curl ipv6.ip.sb 返回结果应该是你的ipv6地址 6.netflix测试，执行如下脚本，如下图则证明解锁成功 wget -O nf https://cdn.jsdelivr.net/gh/sjlleo/netflix-verify/CDNRelease/nf_2.60_linux_amd64 &amp;&amp; chmod +x nf &amp;&amp; clear &amp;&amp; ./nf 7.由于仅解锁ipv6，我们需要让路由优先使用ipv6，验证优先级可以使用 curl ip.p3terx.com 来测试，输出的是ipv4就说明你现在是ipv4优先，反之亦然。修改 /etc/gai.conf 在最后一行添加下面的代码 precedence ::ffff:0:0/96 100 关于代理工具的ipv6优先，请参考如下这篇博客👉IPV6优先 现在，就可以愉快的观看Netflix啦 结语 偷偷用speedtest来测一下Warp的速度 由于我并没有奈菲的账号，为了测试是否成功，去买了一个账号，有效期两个月，结果无法登录。 反馈过去告诉我是代理的问题，实在是想知道结果，又花钱买了一个月的代理，结果还是打不开。 无奈之下，google了一下看看有没有便宜的月抛账号，结果找到了3.5元/月的5日抛，tmd，怪自己没提前去找这种账号，最后的结果就是，代理=22/月、账号20/月x2，一共损失62元。 所以，千万要早睡 END ","link":"https://qianmianyao.cn/post/warp/"},{"title":"搭建KMS在线激活服务器","content":"对比其他版本的kms，更方便了，可以180天后自动续期，搭建方便，无需配置，搭建完毕后仅需要一个简单的bat脚本就可以激活系统 安装 1.首先去github发布页面下载安装包 wget https://github.com/Wind4/vlmcsd/releases/download/svn1113/binaries.tar.gz 2.解压并进入文件夹，确认你的cpu是什么架构，找到linux的可执行文件 cd binaries/Linux/intel/static/ ./vlmcsd-x64-musl-static #直接运行即可 ss -tlp | grep vlmcs #查看端口，应该是1688 3.在windows上编辑一个 kms.bat 文件，写入如下内容 slmgr /skms ip:1688 #填入你的ip和端口 slmgr /ato slmgr /xpr 4.右键 kms.bat 文件，选择以管理员身份运行，一路按确定即可 Wind4/vlmcsd ","link":"https://qianmianyao.cn/post/kms/"},{"title":"Bash命令补全","content":"总是会忘记一些不怎么常用的命令，今天在github逛街的时候发现了bash的一款命令补全工具，十分好用 scop/bash-completion 安装 1.下载bash_completion源码并且解压 wget https://github.com/scop/bash-completion/releases/download/2.11/bash-completion-2.11.tar.xz tar -xf bash-completion-2.11.tar.xz 2.编译安装 cd bash-completion* ./confgure make &amp;&amp; make install 3.编译完毕后底部会出现如下信息，比如 /usr/local/share/bash-completion/bash_completion 就是编译完毕后的安装地址，等会需要用 *********** make install-data-hook make[3]: Entering directory '/root/bash-completion-2.11' tmpfile=`mktemp ${TMPDIR:-/tmp}/bash_completion.XXXXXX` &amp;&amp; \\ /bin/sed -e 's|-/etc/bash_completion\\.d|-/usr/local/etc/bash_completion.d|' \\ /usr/local/share/bash-completion/bash_completion &gt;$tmpfile &amp;&amp; \\ cat $tmpfile &gt;/usr/local/share/bash-completion/bash_completion &amp;&amp; \\ rm $tmpfile make[3]: Leaving directory '/root/bash-completion-2.11' make[2]: Leaving directory '/root/bash-completion-2.11' make[1]: Leaving directory '/root/bash-completion-2.11' 4.修改 .bashrc 文件，在底部添加如下信息，吧path改成你刚才安装完毕的地址 [[ $PS1 &amp;&amp; -f /path ]] &amp;&amp; \\ . /path 5.现在输入命令后，按tab建即可 结语 其实zsh和fish都有很多补全插件，但是在服务器上装这两个东西感觉别扭，也比较麻烦，就找到了支持bash的工具，说实话体验很不错，省去了不记得命令然后去google的时间，大大提升效率 ","link":"https://qianmianyao.cn/post/bash-ming-ling-bu-quan/"},{"title":"File Browser一个简单的网盘程序","content":"使用nginx和程序本体或者docker搭建一个简易的网盘。 File Browser是什么，请移步官方网站：https://filebrowser.xyz 也可以用：https://qianmianyao.cn/28 Nginx 拿centos来演示 先安装nginx yum install nginx -y 安装flie browser curl -fsSL https://filebrowser.org/get.sh | bash 启动flie browser并且让它在后台运行 filebrowser -r /path/to/your/files &amp; # -r 后面设置你要存放文件的路径 启动完毕后默认的端口是8080，当然现在是访问不了的，我们再来设置nginx 编辑nginx配置文件 server { listen 80; server_name localhost; location / { proxy_pass http://127.0.0.1:8080; } } //绑定自己的域名可以将localhost字段改成自己的域名 到这里就设置完毕，我们访问你的vps的IP就可以看到部署完毕的程序了 后台的帐号和密码 Username: admin Password: admin docker安装filebrowser 首先直接使用docker官方的一键脚本安装好docker curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun 获取镜像 docker pull filebrowser/filebrowser 开始配置 mkdir ./filebrowser #建立目录 touch filebrowser.db #建立数据库文件 vim .filebrowser.json #写入配置 写入如下配置 { &quot;port&quot;: 80, &quot;baseURL&quot;: &quot;&quot;, &quot;address&quot;: &quot;&quot;, &quot;log&quot;: &quot;stdout&quot;, &quot;database&quot;: &quot;./database.db&quot;, &quot;root&quot;: &quot;/srv&quot; } 运行程序 docker run \\\\ -v /root/filebrowser:/srv \\\\ -v /root/filebrowser/filebrowser.db:/database.db \\\\ -v /root/filebrowser/.filebrowser.json:/.filebrowser.json \\\\ -p 80:80 \\\\ filebrowser/filebrowser 打开你的http://你的ip:80既可以访问程序啦 ","link":"https://qianmianyao.cn/post/29/"},{"title":"Certbot自动配置SSL","content":"Let’s Encrypt 是一个自动签发 https 证书的免费项目 Certbot 是 Let’s Encrypt 官方推荐的证书生成客户端工具 首先去官网 certbot 箭头指向的地方选择你的web服务器和系统版本 比如我常用的就是nginx和debian 选择好后稍等1-3秒下拉既可以看到官方的部署教程 安装 安装本体和插件 sudo apt-get install certbot python-certbot-nginx 可以选择两种方式获取证书 第一种获取证书并且直接自动化配置nginx文件 sudo certbot --nginx 或者只获取证书文件 sudo certbot certonly --nginx 其实很简单，根据简单流程输入邮箱和域名就好了 Certbot自动配置SSL ","link":"https://qianmianyao.cn/post/28/"},{"title":"Debian安装Redis","content":"本来一只用着mysql，最近折腾nodebb需要用到redis，记录一下安装过程。 准备工作 去官网下载redis源码 wget http://download.redis.io/releases/redis-6.0.5.tar.gz tar -zxf redis-6.0.5 cd redis-6.0.5 开始安装 编译 make 编译完成后会多出来一个src文件夹和redis.conf的配置文件 开始运行 修改配置文件 bind 127.0.0.1 //改成你服务器的ip地址。或者改成0.0.0.0 requirepass ** //设置redis密码。 daemonize yes //以守护进程运行 运行 cd src redis-server /path/redis.conf //启动服务 redis-cli //进入交互界面 ","link":"https://qianmianyao.cn/post/debian-an-zhuang-redis/"},{"title":"网站备份脚本","content":"备份是通过又拍云的官方工具UPX定时上传到又拍云的对象储存中的，使用这个脚本需要先安装UPX和expect，后者用来自动登陆 脚本内容 所有send字段的passwd和user修改成自己的用户名和密码 #!/usr/bin/expect -f set timeout 30 spawn sudo tar -czPf /home/qianmianyao/qianmianyao.cn.tar.gz /home/wwwroot/qianmianyao.cn #自己修改压缩文件名 expect &quot;*user:&quot; send &quot;passwd\\\\r&quot; mysqldump -uuser -ppasswd database&gt;database.sql set timeout 30 spawn upx login expect &quot;ServiceName:&quot; send &quot;user\\\\r&quot; expect &quot;Operator:&quot; send &quot;user\\\\r&quot; expect &quot;Password:&quot; send &quot;passwd&quot; upx rm qianmianyao.cn.tar.gz #修改成自己的压缩文件名，下面一样 upx rm wp.sql upx put qianmianyao.cn.tar.gz upx put wp.sql 结语 利用expect和upx自动登陆，然后知道上传文件，实现备份，不想用upx也可以直接用又拍云提供的ftp，实现效果也是一样的。 UPX ","link":"https://qianmianyao.cn/post/26/"}]}